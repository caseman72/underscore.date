(function(l) {
  function j(a, c) {
    for(var b = a + "";b.length < c;) {
      b = "0" + b
    }
    return b
  }
  function m(a, c, b) {
    var f = (c.ms || 0) + (c.s || 0) * 1E3 + (c.m || 0) * 6E4 + (c.h || 0) * 36E5 + (c.d || 0) * 864E5 + (c.w || 0) * 6048E5, c = (c.M || 0) + (c.y || 0) * 12;
    f && a.setMilliseconds(a.getMilliseconds() + f * b);
    c && (f = a.getDate(), a.setDate(1), a.setMonth(a.getMonth() + c * b), a.setDate(Math.min((new Date(a.getFullYear(), a.getMonth() + 1, 0)).getDate(), f)));
    return a
  }
  function q(a, c) {
    var b = 0;
    switch(_.first(_.filter("y,M,d,h,m,s,ms".split(","), function(a) {
      return a in c
    }))) {
      case "y":
        a.setFullYear(0);
      case "M":
        a.setMonth(0);
      case "d":
        c.d ? b += a.getDate() * 864E5 : a.setDate(1);
      case "h":
        b += a.getHours() * 36E5;
      case "m":
        b += a.getMinutes() * 6E4;
      case "s":
        b += a.getSeconds() * 1E3;
      case "ms":
        b += a.getMilliseconds()
    }
    b && a.setMilliseconds(a.getMilliseconds() - b);
    return a
  }
  function n(a) {
    return new Date(a[0], a[1] || 0, a[2] || 1, a[3] || 0, a[4] || 0, a[5] || 0, a[6] || 0)
  }
  function i(a, c) {
    if(a === l) {
      this.date = new Date
    }else {
      if(a.date instanceof Date) {
        this.date = c === "" ? new Date(a.date.toString()) : a.date
      }else {
        if(a instanceof Date) {
          this.date = c === "" ? new Date(a.toString()) : a
        }else {
          if(c) {
            for(var b = [0, 0, 0, 0, 0, 0, 0], f = /[0-9a-zA-Z]+/g, d = a.match(f), f = c.match(f), e = false, k = 0, g = f.length;k < g;k++) {
              var h = d[k];
              switch(f[k]) {
                case "M":
                ;
                case "MM":
                  b[1] = ~~h - 1;
                  break;
                case "D":
                ;
                case "DD":
                ;
                case "DDD":
                ;
                case "DDDD":
                  b[2] = ~~h;
                  break;
                case "YY":
                  h = ~~h;
                  b[0] = h + (h > 70 ? 1900 : 2E3);
                  break;
                case "YYYY":
                  b[0] = ~~h;
                  break;
                case "a":
                ;
                case "A":
                  e = h.toLowerCase() === "pm";
                  break;
                case "H":
                ;
                case "HH":
                ;
                case "h":
                ;
                case "hh":
                  b[3] = ~~h;
                  break;
                case "m":
                ;
                case "mm":
                  b[4] = ~~h;
                  break;
                case "s":
                ;
                case "ss":
                  b[5] = ~~h
              }
            }
            e && b[3] < 12 && (b[3] += 12);
            this.date = n(b)
          }else {
            Object.prototype.toString.call(a) === "[object Array]" ? this.date = n(a) : r && Object.prototype.toString.call(a) === "[object String]" ? (b = s.exec(a), d = 0, b ? (this.date = new Date(b[1], b[2] - 1, b[3], b[4], b[5], b[6]), b[7] !== "Z" && (d = b[8] * 60 + b[9] * 1, d *= b[7] == "-" ? 1 : -1, d -= this.date.getTimezoneOffset(), d *= 6E4), d !== 0 && this.date.setTime(this.date.getTime() + d)) : this.date = new Date(a)) : this.date = new Date(a)
          }
        }
      }
    }
  }
  function e(a, c) {
    return d.relativeTime[a].replace(/%d/i, c || 1)
  }
  function p(a) {
    var a = Math.abs(a) / 1E3, c = a / 60, b = c / 60, d = b / 24, j = d / 365;
    return a < 45 && e("s", g(a)) || g(c) === 1 && e("m") || c < 45 && e("mm", g(c)) || g(b) === 1 && e("h") || b < 22 && e("hh", g(b)) || g(d) === 1 && e("d") || d < 25 && e("dd", g(d)) || d < 45 && e("M") || d < 345 && e("MM", g(d / 30)) || g(j) === 1 && e("y") || e("yy", g(j))
  }
  var d, g = Math.round, r = isNaN((new Date("2011-11-11T11:11:11+00:00")).getTime()), s = /^(\d{4})-(\d{2})-(\d{2})[ T](\d{2}):(\d{2}):(\d{2})([Z+-])(?:(\d{2}):(\d{2}))?$/;
  d = function(a, c) {
    return new i(a, c)
  };
  d.months = "January,February,March,April,May,June,July,August,September,October,November,December".split(",");
  d.monthsShort = "Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(",");
  d.weekdays = "Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(",");
  d.weekdaysShort = "Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(",");
  d.relativeTime = {future:"in %s", past:"%s ago", s:"seconds", m:"a minute", mm:"%d minutes", h:"an hour", hh:"%d hours", d:"a day", dd:"%d days", M:"a month", MM:"%d months", y:"a year", yy:"%d years"};
  d.ordinal = function(a) {
    var c = a % 10;
    return~~(a % 100 / 10) === 1 ? "th" : c === 1 ? "st" : c === 2 ? "nd" : c === 3 ? "rd" : "th"
  };
  i.prototype = {format:function(a) {
    function c(a) {
      var b;
      switch(a) {
        case "M":
          return f + 1;
        case "Mo":
          return f + 1 + d.ordinal(f + 1);
        case "MM":
          return j(f + 1, 2);
        case "MMM":
          return d.monthsShort[f];
        case "MMMM":
          return d.months[f];
        case "D":
          return e;
        case "Do":
          return e + d.ordinal(e);
        case "DD":
          return j(e, 2);
        case "DDD":
          return a = new Date(g, f, e), b = new Date(g, 0, 1), ~~((a - b) / 864E5 + 1.5);
        case "DDDo":
          return a = c("DDD"), a + d.ordinal(a);
        case "DDDD":
          return j(c("DDD"), 3);
        case "d":
          return k;
        case "do":
          return k + d.ordinal(k);
        case "ddd":
          return d.weekdaysShort[k];
        case "dddd":
          return d.weekdays[k];
        case "w":
          return a = new Date(g, f, e - k + 5), b = new Date(a.getFullYear(), 0, 4), ~~((a - b) / 864E5 / 7 + 1.5);
        case "wo":
          return a = c("w"), a + d.ordinal(a);
        case "ww":
          return j(c("w"), 2);
        case "YY":
          return(g + "").slice(-2);
        case "YYYY":
          return g;
        case "a":
          return i > 11 ? "pm" : "am";
        case "A":
          return i > 11 ? "PM" : "AM";
        case "H":
          return i;
        case "HH":
          return j(i, 2);
        case "h":
          return i % 12 || 12;
        case "hh":
          return j(i % 12 || 12, 2);
        case "m":
          return h;
        case "mm":
          return j(h, 2);
        case "s":
          return l;
        case "ss":
          return j(l, 2);
        case "ZZ":
          return(m > 0 ? "-" : "+") + j(m, 2) + ":00";
        case "z":
          return c("zz").replace(n, "");
        case "zz":
          return a = o.indexOf("("), a > -1 ? o.slice(a + 1, o.indexOf(")")) : o.slice(o.indexOf(":")).replace(n, "");
        default:
          return a.replace("\\", "")
      }
    }
    var b = this.date, f = b.getMonth(), e = b.getDate(), g = b.getFullYear(), k = b.getDay(), i = b.getHours(), h = b.getMinutes(), l = b.getSeconds(), o = b.toString(), m = b.getTimezoneOffset() / 60, n = /[^A-Z]/g;
    return a.replace(/(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|dddd?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|zz?|ZZ)/g, c)
  }, add:function(a) {
    a = a || {};
    this.date = m(this.date, a, 1);
    return this
  }, subtract:function(a) {
    a = a || {};
    this.date = m(this.date, a, -1);
    return this
  }, change:function(a) {
    a = a || {};
    this.date = m(q(this.date, a), a, 1);
    return this
  }, gmt:function() {
    var a = this.date.getTimezoneOffset();
    return(new i(this.date.toString())).add({m:a})
  }, toString:function() {
    return this.date.toString()
  }, valueOf:function() {
    return this.date.getTime()
  }, getTime:function() {
    return this.date.getTime()
  }, from:function(a, c, b) {
    var a = (isNaN(this.date) ? (new i(this.date)).date.getTime() : this.date) - (isNaN(a) ? (new i(a)).date.getTime() : a), e = a < 0 ? d.relativeTime.past : d.relativeTime.future;
    return b ? a : c ? p(a) : e.replace(/%s/i, p(a))
  }, fromNow:function(a, c) {
    return this.from(new i, a, c)
  }, isLeapYear:function() {
    var a = this.date.getFullYear();
    return a % 4 === 0 && a % 100 !== 0 || a % 400 === 0
  }};
  typeof window === "undefined" && typeof module !== "undefined" ? module.exports = d : (this._ !== l && this._.mixin !== l && this._.mixin({date:d}), this._date = d)
})();

